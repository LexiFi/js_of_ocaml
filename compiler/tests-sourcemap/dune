(env
 (_
  (js_of_ocaml
   (compilation_mode separate))))

(executable
 (name test)
 (modules test)
 (modes js)
 (enabled_if
  (and
   (<> %{profile} wasm)
   (<> %{profile} wasm-effects)))
 (js_of_ocaml
  (link_flags
   (:standard --source-map-root /my/sourceRoot)))
 (libraries testlib))

(library
 (name testlib)
 (enabled_if
  (and
   (<> %{profile} wasm)
   (<> %{profile} wasm-effects)))
 (modules a b c d))

(test
 (name dump_sourcemap)
 (modules dump_sourcemap)
 (action
  (run %{test} %{dep:test.bc.js}))
 (enabled_if
  (= %{profile} dev))
 (libraries js_of_ocaml-compiler))
